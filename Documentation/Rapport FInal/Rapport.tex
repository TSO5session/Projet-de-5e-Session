\documentclass[10pt,a4paper,final]{article}

\include{TeX/Packages}   % Packages et dépendances nécessaires
\include{TeX/SourceCode} % Permet de mettre du code source dans le document

\begin{document}
\renewcommand\headrulewidth{0pt}
\fancyfoot[C]{ }






\begin{center}
\includegraphics[scale=1]{Figures/School_Logo.jpg}~\\[1cm]  
\textsc{\LARGE \'{E}lectronique Programmable et Robotique}\\[1.5cm]
\Large 247-6[1-2-3-4]7-LI\\[0.5cm]
{ \huge \bfseries Projet de 5$\mathbf{^{e}}$ session \\[0.4cm] }
\HRule \\[1.5cm]





\begin{multicols}{2}
\begin{flushleft}



\textbf{Étudiants:}\\

\bigskip

Vincent Chouinard\\
Hicham Safoine\\
Gabriel Fortin-Bélanger\\ 
Louis-Nomand Ang-Houle\\




\end{flushleft}
\vfill
\begin{flushright}

\textbf{Professeurs:}\\
\medskip
Ali Tadli\\
Alain Champagne\\
Stéphane Deschênes\\
Étienne Tremblay\\



\end{flushright}
\end{multicols}

\bigskip
\bigskip


\includegraphics[scale=0.6]{Figures/Picture_for_Title.jpg} 

\vfill
L'usine à gaz, et le gaz, c'est de l'air!
\bigskip

{\large \today}
\end{center}






\pagebreak
\begin{spacing}{1.24999}
\tableofcontents 
%\pagebreak
\listoffigures  
\listoftables 
\end{spacing}  
\pagebreak






\renewcommand\headrulewidth{1pt}
\fancyhead[L]{247-6[1-2-3-4]7-LI}
\fancyhead[R]{Projet de 5$\mathbf{^{e}}$ session}

\renewcommand\footrulewidth{1pt}
\fancyfoot[C]{\textbf{page \thepage}}
\fancyfoot[R]{\today}
\fancyfoot[L]{V.C., H.S., G.F-B., L-N.A-H.}
\begin{spacing}{1.5}

\section{Présentation du projet}
Le projet de la cinquième session consiste à réaliser
\begin{itemize}
\item[$\Rightarrow$] Le Bolide
\item[$\Rightarrow$] Carte Dallas DS89C450
\item[$\Rightarrow$] Carte uPSD 3254A
\item[$\Rightarrow$] SOC8200
\item[$\Rightarrow$] Table FESTO
\item[$\Rightarrow$] Carte PIC16F88
\item[$\Rightarrow$] Carte d'extension I{\small 2}C
\item[$\Rightarrow$] Carte d'extension SPI
\item[$\Rightarrow$] Une pile de 10.8 volts
\item[$\Rightarrow$] Quatre moteurs et autant de pneus
\end{itemize}

\subsection{Explication du projet}

\subsection{Schéma bloc du système}
\subsubsection{Bloc 1}
Le bloc 1 est composé d'un ordinateur muni d'une carte d'extension PCI vers bus CAN. Son rôle est de contrôler et diriger toute l'opération et de veiller au bon fonctionnement de chaque composantes à l'aide d'une application en Csharp. Le bloc 1 est le cerveau de l'usine.
 
\subsubsection{Bloc 2}
Le bloc 2 est composé d'un système embarqué Linux basé sur le SOC8200. Son rôle principal est d'agir comme sniffeur d'information et d'afficher sur son écran toutes les données qui transitent sur le bus CAN. Toutefois, ce dernier est en mesure de détecter une défaillance du PC via un gestionnaire de HeartBeat et de prendre la relève en tant que cerveau de l'opération. Le SOC8200 agit comme vice-président du bus CAN.

\subsubsection{Bloc 3}

\subsubsection{Bloc 4}

\subsection{Liste des logiciels}
\begin{flushleft}
\HRule
\end{flushleft}
\begin{flushleft}

\begin{multicols}{3}

\textbf{Terminaux}
\begin{itemize}
\item[•]UART Master 1.0.3
\item[•]Serializ3r 1.0.2
\item[•]TerraTerm
\item[•]Putty
\item[•]GTKterm 0.99.7-rc1
\item[•]xTerminator
\item[•]CAPS
\item[•]tinyBootloader
\end{itemize}

\textbf{Gestion du projet}
\begin{itemize}
\item[•]MS Project 2012
\item[•]Git Hub
\end{itemize}

\textbf{Compilateurs et IDE}
\begin{itemize}
\item[•]Visual Studio 2013
\item[•]Visual Studio 2010
\item[•]IAR 8.20
\item[•]MPLAB
\end{itemize}

\textbf{Éditeur de texte}
\begin{itemize}
\item[•]Notepad++
\item[•]gedit
\item[•]medit 1.2.0
\end{itemize}
\textbf{Schémas électriques}

\begin{itemize}
\item[•]OrCAD 16.2
\end{itemize}

\bigskip

\textbf{Système d'exploitation}
\begin{itemize}
\item[•]Windows 7 SP1
\item[•]Windows 8.1
\item[•]Windows XP SP3
\item[•]Fedora 20
\item[•]CentOS
\item[•]Lubuntu 14.10
\end{itemize}

\textbf{Autres}
\begin{itemize}
\item[•]VMWare Workstation 10
\item[•]TeXmaker 4.3
\item[•]Dukto R6
\item[•]Dia
\item[•]Festo configuration tool
\end{itemize}

\end{multicols}
\end{flushleft}
\begin{flushleft}
\HRule
\end{flushleft}

\pagebreak
\subsection{Liste des trames}

\begin{table}[!ht]
\caption{Index des identifiants matériel CAN}
\medskip
\centering
\begin{tabular}{|l|c|}
\hline 
\textbf{Device} & \textbf{ID matériel} \\ 
\hline 
Ordinateur & 000 \\ 
\hline 
SOC8200 & 001 \\ 
\hline 
Station 1 & 002 \\ 
\hline 
Station 2  & 003 \\ 
\hline
Station 3  & 004 \\
\hline 
Véhicule  & 005 \\ 
\hline 
\end{tabular} 
\label{tab:testtab1}
\end{table} 


\begin{table}[!ht]
\caption{Index des trames CAN}
\medskip
\centering
\begin{tabular}{|l|c|l|c|}
\hline 
\textbf{Fonctionnalité} & \textbf{Composante} & \textbf{Données} & \textbf{TimeStamp}\\
\hline 
Démarre le véhcule & 0x00 & 0x00 & TimeStamp\\ 
\hline 
Arrête le véhicule & 0x00 & 0x01 & TimeStamp\\ 
\hline 
Le véhicule est arrêté & 0x01 & 0x00 & TimeStamp\\ 
\hline 
Le véhicule est en marche& 0x01 & 0x01 & TimeStamp\\ 
\hline 
Le véhicule est hors circuit & 0x01 & 0x02 & TimeStamp\\ 
\hline 
Vitesse (0-100) & 0x02 & 0x00 à 0x64 & TimeStamp\\ 
\hline 
Battrie & 0x03 & 0x00 à 0x64 & TimeStamp\\ 
\hline 
Couleur du bloc & 0x04 & 0x00 à 0x02 & TimeStamp\\ 
\hline 
Poids du bloc & 0x05 & 0x00 à 0x64 & TimeStamp\\ 
\hline 
Envoyer l'heure & 0x06 & à déterminer  & TimeStamp\\ 
\hline 
No. de la station & 0x07 & 0x00 à 0x02 & TimeStamp\\ 
\hline 
Demande de l'historique & 0xC0 & 0x00 & TimeStamp\\ 
\hline 
Direction horaire et antihoraire & 0x08 & 0x00 à 0x01 & TimeStamp\\
\hline
\end{tabular} 
\label{tab:testtab1}
\end{table}

\begin{table}[!ht]
\caption{Index des communications CAN}
\medskip
\centering
\begin{tabular}{|l|l|c|l|c|l|c|}
\hline 
\textbf{Émetteur} & \textbf{Action} & \textbf{ID receveur} & \textbf{Donnée envoyée} & \textbf{TimeStamp} & \textbf{Récepteur} & \textbf{Erreur}\\ 
\hline 
Ordinateur & Démarrer le véhicule & 004 & 00 00 & TimeStamp & Véhicule &  F1\\ 
\hline 
Ordinateur & Arrêter le véhicule & 004 & 00 01 & TimeStamp & Véhicule &  F2\\ 
\hline 
Véhicule & Dit: je suis arrêté & 000 & 01 00  & TimeStamp & Ordinateur &  F3\\
\hline 
Véhicule & Dit: j'avance & 000 & 01 01 & TimeStamp & Ordinateur  &  F4\\  
\hline 
Véhicule & Dit: je suis hors circuit & 000 & 01 02 & TimeStamp & Ordinateur &  F5\\ 
\hline 
Véhicule & Dit sa vitesse & 000 & 02 [00 à 64] & TimeStamp & Ordinateur &  F6\\ 
\hline 
Véhicule & Dit le niveau de sa battrie & 000 & 03 [00 à 64] & TimeStamp & Ordinateur &  F7\\ 
\hline 
Station 1 & Dit bloc = métal & 000 & 04 00 & TimeStamp & Ordinateur &  F8\\ 
\hline  
Station 1 & Dit bloc = orange & 000 & 04 01 & TimeStamp & Ordinateur &  F9\\
\hline 
Station 1 & Dit bloc = noir & 000 & 04 02 & TimeStamp & Ordinateur &  FA\\
\hline 
Station 1 & Dit le poid du bloc & 000 & 05 [00 à 64] & TimeStamp & Ordinateur &  FB\\ 
\hline 
Voiture & Dit qu'elle est à la station 1 & 000 & 07 00 & TimeStamp & Ordinateur &  FC\\ 
\hline 
Voiture & Dit qu'elle est à la station 2 & 000 & 07 01 & TimeStamp & Ordinateur &  FD\\
\hline 
Ordinateur & Envoie l'heure & 003 & 06 à déterminer & TimeStamp & Station 1 &  FE\\ 
\hline 
Ordinateur & Demande le LOG & 001 & C0 00 & TimeStamp & SOC8200 & E0\\ 
\hline
Ordinateur & Exige Horaire & 004 & 08 00 & TimeStamp & Véhicule & E1\\ 
\hline
Ordinateur & Exige Antihoraire & 004 & 08 01 & TimeStamp & Véhicule & E2\\ 
\hline
\end{tabular} 
\label{tab:testtab1}
\end{table}
\begin{flushleft}
\textbf{Note:} Il faut définir les TimeStamps et la checkSUM\\
\textbf{Note:} La station no.1 relaie les données entre l'ordinateur et la station no.3 (pesage), entre l'ordinateur et la station no.2 (table Festo) via xbee et entre la voiture et le PC via Xbee.
\end{flushleft}
\pagebreak
\textbf{Note:} FF, c'est la checkSUM, mais elle n'a pas encore été faite \\
\textbf{Note:} Il faut ajouter le TimeStamp 
\begin{verbatim}
   CAN.SendMCP("0100FF"); // Arrêté
   CAN.SendMCP("0101FF"); // En marche
   CAN.SendMCP("0102FF"); // Hors circuit
   CAN.SendMCP("0264FF"); // Vitesse maximale
   CAN.SendMCP("0364FF"); // Battrie pleine
   CAN.SendMCP("0400FF"); // Bloc métallique
   CAN.SendMCP("0401FF"); // Bloc noire
   CAN.SendMCP("0402FF"); // Bloc orange
   CAN.SendMCP("050064"); // Le bloc est lourd
   CAN.SendMCP("0700FF"); // Rendu à la station 1
   CAN.SendMCP("0701FF"); // Rendu à la station 2
   CAN.SendMCP("0702FF"); // Rendu à la station 3
\end{verbatim}

\pagebreak

\end{spacing}
f
\begin{spacing}{1.5}
\pagebreak

\section{Le matériel}
\subsection{Bloc 1}
D'un pont de vu matériel, le bloc 1 est le plus simple, car il est composé d'un ordinateur Windows munie d'une carte PCI vers CAN et d'une prise RS232. Il n'y a rien à faire, mise à part brancher les bons câbles aux bons endroits.

\subsection{Bloc 2}

\subsection{Bloc 3}

\subsection{Bloc 4}



\subsection{Explication des types de liens}
\subsubsection{RS232}
Un lien RS232 9600 Bauds est établi entre l'ordinateur et le SOC8200. Ce lien sert à l'envoie et à la réception de HeartBeat, afin que le SOC8200 ou l'ordinateur soit informé de toute défaillance de l'autre.

\subsubsection{Xbee}
Lorsque les modules Xbee sont adéquatement configurés, ils font office de remplacement au câble RS232. En effet, nos Xbee discutent entre eux à l'aide du protocole de communication RS232 à 9600 bauds.  


\subsection{Explication des trames}
\subsubsection{RS-232}

\subsubsection{CAN}

\subsubsection{XBEE}




\subsection{Liste des pièces}
\begin{center}
\HRule
\end{center}
\begin{multicols}{3}
\begin{itemize}
\item[•]Carte Dallas
\item[•]Carte uPSD
\item[•]SOC 8200
\item[•]PIC18Fmachin
\item[•]Carte d'extension SPI
\item[•]Carte d'extension I2C
\item[•]Carte CAN MCP2515
\item[•]XBEE
\item[•]Table FESTO
\item[•]Carte d'extension IO
\item[•]Carte connecteur DAC ADC
\item[•]Carte Xbee vers DB9
\item[•]
\item[•]
\item[•]
\item[•]
\item[•]
\item[•]
\item[•]
\end{itemize}
\end{multicols}
\begin{center}
\HRule
\end{center}

\subsubsection{Liens web}
Mettre ien vers GitHUB

\subsubsection{Datasheets}
Note: Toutes les datasheets sont en format non-compressé. Vous pouvez zoomer sur le document PDF\footnote{Présenter les datasheets de la sorte économise du papier, donc des arbres, mais requiert de consulter le document .PDF afin de lire adéquatement les datasheets.} afin de lire l'intégralité de leurs première page.
\begin{multicols}{3}
74HC14\\
\fbox{\includegraphics[scale=0.2]{Figures/Datasheets/74HC14.pdf}}\\
DAC6574\\
\fbox{\includegraphics[scale=0.2]{Figures/Datasheets/dac6574.pdf}}\\
DS89C450\\
\fbox{\includegraphics[scale=0.2]{Figures/Datasheets/DS89C450.pdf}}\\

\medskip

LineSensors\\
\fbox{\includegraphics[scale=0.2]{Figures/Datasheets/LineSensor.pdf}}\\
LM3914\\
\fbox{\includegraphics[scale=0.2]{Figures/Datasheets/lm3914.pdf}}\\
OPT101\\
\fbox{\includegraphics[scale=0.2]{Figures/Datasheets/opt101.pdf}}\\

\medskip

PCF8573\\
\fbox{\includegraphics[scale=0.2]{Figures/Datasheets/PCF8574.pdf}} \\
uPSD3254A\\
\fbox{\includegraphics[scale=0.2]{Figures/Datasheets/UPSD3254A.pdf}}\\
SaberTooth motor drive\\
\fbox{\includegraphics[scale=0.2]{Figures/Datasheets/Sabertooth.pdf}}\\
\end{multicols}
\vfill
\pagebreak
\section{Interface PC}

\begin{figure}[hbtp]
\caption{Programme de contrôle principal}
\centering
\fbox{\includegraphics[scale=0.7]{Figures/programme.png}}
\end{figure}

Notre programme, écrit en C\# à l'aide de Visual Studio, peut se connecter au bus CAN via une carte SPI\footnote{Spécifier le fabricant} et au bus RS232 via un câble DB9 ou USB\footnote{S'il y a présence d'un FTDI}. La connexion RS232 sert à l'envoie et à la réception du HeartBeat afin d'informer le SOC8200 si l'ordinateur en venait à connaître une défaillance. De plus, des témoins lumineux s'allument en présence de données transmises et reçues. \\
Le programme peut lire l'heure interne du PC et, par un simple clic sur le bouton «Synchroniser», ajuster l'heure de référence de la station no.1.\\
\vfill
\pagebreak





\begin{figure}[hbtp]
\caption{Options CAN avancées}
\centering
\fbox{\includegraphics[scale=0.7]{Figures/programme.png}}
\end{figure}
Il est possible d'utiliser des fonctionnalités CAN avancées tels que les masques et filtres de données. De plus, cette fenêtre permet de visualiser les données CAN reçues à l'état brutes et non traitées, ce qui peut s'avérer utile pour du débogage.


\pagebreak
\begin{figure}[hbtp]
\caption{Historique des actions}
\centering
\fbox{\includegraphics[scale=0.7]{Figures/programme.png}}
\end{figure}
Toute action effectué via le programme ainsi que toute donnée ayant transité sur le bus CAN et RS232 est catalogué en bonne et due forme dans l'onglet historique qu'il est possible de consulter et sauvegarder à tout moment.



\subsection{Structure du programme}
\subsubsection{Les Ghosts Labels}
Un ghost label est un label de texte présent sur l'interface, mais définit comme invisible. Il est doc impossible pour l'usager de le voir et d'y accéder. Leurs principales utilités est de faire office de variable globale afin de passer des paramètres entre fonctions et de déclencher des événements système lorsqu'ils sont lut ou modifié.


\subsection{Explication des trames}

\subsection{Ordre de gestion des tâches}





\pagebreak
\section{Logiciel du SOC8200}
\subsection{Description du programme}
Le programme du SOC2800 est écrit en script Shell\footnote{Car c'est plus simple que de se battre avec le gestionnaire de licence de Sourcery Codebench}\footnote{L'un des membres de l'équipe fait dire que les licences sont une horreur inacceptable sur un système Linux}

\subsection{Schéma bloc}
\subsubsection{Du code}

\subsubsection{Du script shell}

\subsection{Gestion des processus et du temps de CPU}

\subsection{Format et récupration des logs}

\subsection{Liste des tests et logiciels}






\pagebreak
\section{Logiciel de la station 1 et 2 et du bolide}
Le programme de la station 1, 2 et du bolide est écrit en C++ à l'aide d'IAR WorkBench 8.20 et la compilation conditionnelle offre de le compiler pour chacune des trois stations mentionnées. De plus, la compilation conditionnelle permet au bolide d'utiliser soit une carte d'extension I2C, soit une carte d'extension SPI pour contrôler ses moteurs.

\subsection{La station no.1}
La sation no.1 est composé de $\mu$PSD et s'appelle Bloc no.2 dans le cahier de consignes. Cette station reçoit les directives du PC par le BUS CAN et les expédie sur le bus CAN (et vice-versa) aux endroits appropriés. C'est aussi à cette station qu'incombe la tâche de communiquer avec le bolide et la table FESTO via des Xbee
\subsection{La station no.2}
La sation no.2 est composé de la table FESTO et s'appelle Bloc no.3 dans le cahier de consignes

\subsection{Le bolide}
\begin{table}[!ht]
\centering
\begin{tabular}{|l|c|l|}
\hline 
\textbf{Composante} & \textbf{Adresse I{\small 2}C} & \textbf{Description} \\ 
\hline 
MAX1236 & 0x68 & Convertisseur analogique-numérique \\ 
\hline 
DS1307  & 0xD0 & Circuit d'horloge RTC \\ 
\hline 
PCF8574 & 0x40 & I/O Expender pour bus I{\small 2}C \\ 
\hline 
DAC6574 & 0x98  & Convertisseur numérique-analogique  \\ 
\hline 
OPT101  &  0x50 & Suiveur de ligne  \\ 
\hline 
\end{tabular} 
\caption{Informations sur le bus I{\small 2}C du bolide}
\label{tab:testtab1}
\end{table}

\subsection{Procédure de compilation sur IAR}
\end{spacing}
\begin{verbatim}
   //#define UPSD3254A
   //#define DALLAS89C450
   //#define SPI_DALLAS
   //#define I2C_DALLAS
   //#define PCF_5_CAPTEURS
   //#define PCF_3_CAPTEURS
\end{verbatim}
\begin{spacing}{1.5}
\subsection{Procédure de vérification}


\section{Logiciel du module PIC18F258}
\subsection{Description du fonctionnement du programme}

\subsection{Procédure de compilation sur MPLAB}

\subsection{Procédure de vérification}

\pagebreak
\section{Calculs}
\subsection{Calcul du pas de conversion de la pile}
$V_{MAX}=10.8V \Rightarrow MAX1236  = 12 bit \Rightarrow Pas = \dfrac{4K\Omega \cdot \left(\dfrac{10.8V}{10K\Omega}\right)}{2^{12}(pas)} = 1.33(mV/pas)$
\subsection{Calcul du baudrate}
$Baud = \dfrac{2^{SMOD}}{32}\cdot\dfrac{Crystal (Hz)}{12\cdot(256 - TH1)}$\\
\pagebreak
%\bigskip

Alors...\\


$\overbrace{9600 = \dfrac{2^{1}}{32} \cdot \dfrac{24\cdot10^{6}(Hz)}{12\cdot(256 - 243)}}^{uPSD 3254} $ $\Leftarrow \& \Rightarrow $ $ \overbrace{9600 = \dfrac{2^{0}}{32}\cdot \dfrac{11.0597 \cdot 10^{6}(Hz)}{12\cdot(256 - 253)}}^{DS89C450}$





\pagebreak
\section{Conclusion}

\subsection{Ce que le projet m'a apporté}
\subsubsection{Vincent Chouinard}

\subsubsection{Hicham Safoine}

\subsubsection{Gabriel Fortin-Bélanger}

\subsubsection{Louis-Norman Ang-Houle}



\subsection{Difficultés et corrections}
\subsubsection{Vincent Chouinard}

\subsubsection{Hicham Safoine}

\subsubsection{Gabriel Fortin-Bélanger}

\subsubsection{Louis-Norman Ang-Houle}


\subsection{Ce que j'ai aimé ou pas}
\subsubsection{Vincent Chouinard}

\subsubsection{Hicham Safoine}

\subsubsection{Gabriel Fortin-Bélanger}

\subsubsection{Louis-Norman Ang-Houle}
\end{spacing}
\end{document}

