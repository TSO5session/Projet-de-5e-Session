///////////////////////////////////////////////////////////////////////////////
//                                                                            /
// IAR C/C++ Compiler V8.20.2.41139 for 8051            19/Nov/2014  10:59:03 /
// Copyright 2004-2013 IAR Systems AB.                                        /
//                                                                            /
//    Core               =  plain                                             /
//    Code model         =  near                                              /
//    Data model         =  large                                             /
//    Calling convention =  xdata reentrant                                   /
//    Constant location  =  data                                              /
//    Dptr setup         =  1,16                                              /
//                                                                            /
//    Source file        =  J:\Projet_Session5_LNAH\S2_18Nov2014\Programme    /
//                          Station 2\FESTO\Libraire\CLI2CReg.cpp             /
//    Command line       =  "J:\Projet_Session5_LNAH\S2_18Nov2014\Programme   /
//                          Station 2\FESTO\Libraire\CLI2CReg.cpp" -D         /
//                          UPSD3254A --preprocess=cl                         /
//                          "J:\Projet_Session5_LNAH\S2_18Nov2014\Programme   /
//                          Station 2\FESTO\UPSD\List\" -lC                   /
//                          "J:\Projet_Session5_LNAH\S2_18Nov2014\Programme   /
//                          Station 2\FESTO\UPSD\List\" -lA                   /
//                          "J:\Projet_Session5_LNAH\S2_18Nov2014\Programme   /
//                          Station 2\FESTO\UPSD\List\" -o                    /
//                          "J:\Projet_Session5_LNAH\S2_18Nov2014\Programme   /
//                          Station 2\FESTO\UPSD\Obj\" -e --no_cse            /
//                          --no_unroll --no_inline --no_code_motion          /
//                          --no_tbaa --debug --core=plain --dptr=16,1        /
//                          --data_model=large --code_model=near              /
//                          --calling_convention=xdata_reentrant              /
//                          --place_constants=data --nr_virtual_regs 8        /
//                          --dlib_config "C:\Program Files\IAR               /
//                          Systems\Embedded Workbench                        /
//                          6.4\8051\LIB\DLIB\dl8051Normal.h" -I              /
//                          "J:\Projet_Session5_LNAH\S2_18Nov2014\Programme   /
//                          Station 2\FESTO\Libraire\" -Ol --eec++            /
//    List file          =  J:\Projet_Session5_LNAH\S2_18Nov2014\Programme    /
//                          Station 2\FESTO\UPSD\List\CLI2CReg.s51            /
//                                                                            /
//                                                                            /
///////////////////////////////////////////////////////////////////////////////

        NAME CLI2CReg

        RTMODEL "__SystemLibrary", "DLib"
        RTMODEL "__calling_convention", "xdata_reentrant"
        RTMODEL "__code_model", "near"
        RTMODEL "__core", "plain"
        RTMODEL "__data_model", "large"
        RTMODEL "__dptr_size", "16"
        RTMODEL "__extended_stack", "disabled"
        RTMODEL "__location_for_constants", "data"
        RTMODEL "__number_of_dptrs", "1"
        RTMODEL "__rt_version", "1"

        RSEG DOVERLAY:DATA:NOROOT(0)
        RSEG IOVERLAY:IDATA:NOROOT(0)
        RSEG ISTACK:IDATA:NOROOT(0)
        RSEG PSTACK:XDATA:NOROOT(0)
        RSEG XSTACK:XDATA:NOROOT(0)

        ERROR
//NOTE: This module defines or uses C++ features that are not
//      accessible from assembler code. Assembling this file will
//      not produce an equivalent object file to the one produced
//      by the C++ compiler.

        EXTERN ?FUNC_ENTER_XDATA
        EXTERN ?FUNC_LEAVE_XDATA
        EXTERN ?V0
        EXTERN __INIT_XDATA_Z

        PUBLIC ??CLI2CReg
        FUNCTION ??CLI2CReg,0203H
        ARGFRAME XSTACK, 0, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        PUBLIC ??I2C_State
        PUBLIC `??delete ~CLI2CReg`
        FUNCTION `??delete ~CLI2CReg`,021203H
        ARGFRAME XSTACK, 0, STACK
        LOCFRAME XSTACK, 8, STACK
        PUBLIC ??i2c_isr
        FUNCTION ??i2c_isr,0233H
        ARGFRAME XSTACK, 0, STACK
        LOCFRAME ISTACK, 5, STACK
        PUBWEAK `??i2c_isr??INTVEC 67`
        PUBLIC ??i2c_timeout_flag
        PUBLIC ??i2cwait
        PUBLIC `??new CLI2CReg`
        FUNCTION `??new CLI2CReg`,021203H
        ARGFRAME XSTACK, 0, STACK
        LOCFRAME ISTACK, 2, STACK
        PUBLIC ??slave_nack_flag
        PUBLIC ??ucI2CMaster_Transmit
        FUNCTION ??ucI2CMaster_Transmit,021203H
        ARGFRAME XSTACK, 0, STACK
        LOCFRAME XSTACK, 9, STACK
        PUBLIC ??ucI2C_MX
        PUBLIC ??upsd_i2c_rcv
        FUNCTION ??upsd_i2c_rcv,021203H
        ARGFRAME XSTACK, 0, STACK
        LOCFRAME ISTACK, 1, STACK
        LOCFRAME XSTACK, 8, STACK
        PUBLIC ??vI2CRegInit
        FUNCTION ??vI2CRegInit,0203H
        ARGFRAME XSTACK, 0, STACK
        LOCFRAME ISTACK, 2, STACK
        PUBLIC ??vWaitForInt
        FUNCTION ??vWaitForInt,0203H
        ARGFRAME XSTACK, 9, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME ISTACK, 2, STACK
        PUBLIC `?~CLI2CReg`
        FUNCTION `?~CLI2CReg`,0203H
        ARGFRAME XSTACK, 8, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        PUBWEAK S2DAT
        PUBWEAK _A_IE
        PUBWEAK _A_IEA
        PUBWEAK _A_IPA
        PUBWEAK _A_P1
        PUBWEAK _A_P3SFS
        PUBWEAK _A_S2CON
        PUBWEAK _A_S2STA
        PUBLIC bus_lost_flag
        PUBLIC dummybyte
        PUBLIC i
        PUBLIC i2c_init_flag
        PUBLIC i2c_master
        PUBLIC i2c_rcv_buf
        PUBLIC i2c_timeout
        PUBLIC i2c_xmit_buf
        PUBLIC i2c_xmitr
        
          CFI Names cfiNames0
          CFI StackFrame CFA_SP SP IDATA
          CFI StackFrame CFA_PSP16 PSP16 XDATA
          CFI StackFrame CFA_XSP16 XSP16 XDATA
          CFI StaticOverlayFrame CFA_IOVERLAY IOVERLAY
          CFI StaticOverlayFrame CFA_DOVERLAY DOVERLAY
          CFI Resource `PSW.CY`:1, `B.BR0`:1, `B.BR1`:1, `B.BR2`:1, `B.BR3`:1
          CFI Resource `B.BR4`:1, `B.BR5`:1, `B.BR6`:1, `B.BR7`:1, `VB.BR8`:1
          CFI Resource `VB.BR9`:1, `VB.BR10`:1, `VB.BR11`:1, `VB.BR12`:1
          CFI Resource `VB.BR13`:1, `VB.BR14`:1, `VB.BR15`:1, VB:8, B:8, A:8
          CFI Resource PSW:8, DPL0:8, DPH0:8, R0:8, R1:8, R2:8, R3:8, R4:8, R5:8
          CFI Resource R6:8, R7:8, V0:8, V1:8, V2:8, V3:8, V4:8, V5:8, V6:8, V7:8
          CFI Resource SP:8, PSPH:8, PSPL:8, PSP16:16, XSPH:8, XSPL:8, XSP16:16
          CFI VirtualResource ?RET:16, ?RET_HIGH:8, ?RET_LOW:8
          CFI ResourceParts PSP16 PSPH, PSPL
          CFI ResourceParts XSP16 XSPH, XSPL
          CFI ResourceParts ?RET ?RET_HIGH, ?RET_LOW
          CFI EndNames cfiNames0
        
          CFI Common cfiCommon0 Using cfiNames0
          CFI CodeAlign 1
          CFI DataAlign -1
          CFI ReturnAddress ?RET CODE
          CFI CFA_DOVERLAY Used
          CFI CFA_IOVERLAY Used
          CFI CFA_SP SP+-2
          CFI CFA_PSP16 PSP16+0
          CFI CFA_XSP16 XSP16+0
          CFI `PSW.CY` SameValue
          CFI `B.BR0` SameValue
          CFI `B.BR1` SameValue
          CFI `B.BR2` SameValue
          CFI `B.BR3` SameValue
          CFI `B.BR4` SameValue
          CFI `B.BR5` SameValue
          CFI `B.BR6` SameValue
          CFI `B.BR7` SameValue
          CFI `VB.BR8` SameValue
          CFI `VB.BR9` SameValue
          CFI `VB.BR10` SameValue
          CFI `VB.BR11` SameValue
          CFI `VB.BR12` SameValue
          CFI `VB.BR13` SameValue
          CFI `VB.BR14` SameValue
          CFI `VB.BR15` SameValue
          CFI VB SameValue
          CFI B Undefined
          CFI A Undefined
          CFI PSW SameValue
          CFI DPL0 SameValue
          CFI DPH0 SameValue
          CFI R0 Undefined
          CFI R1 Undefined
          CFI R2 Undefined
          CFI R3 Undefined
          CFI R4 Undefined
          CFI R5 Undefined
          CFI R6 SameValue
          CFI R7 SameValue
          CFI V0 SameValue
          CFI V1 SameValue
          CFI V2 SameValue
          CFI V3 SameValue
          CFI V4 SameValue
          CFI V5 SameValue
          CFI V6 SameValue
          CFI V7 SameValue
          CFI PSPH Undefined
          CFI PSPL Undefined
          CFI XSPH Undefined
          CFI XSPL Undefined
          CFI ?RET Concat
          CFI ?RET_HIGH Frame(CFA_SP, 2)
          CFI ?RET_LOW Frame(CFA_SP, 1)
          CFI EndCommon cfiCommon0
        
        
          CFI Common cfiCommon1 Using cfiNames0
          CFI CodeAlign 1
          CFI DataAlign -1
          CFI ReturnAddress ?RET CODE
          CFI CFA_DOVERLAY Used
          CFI CFA_IOVERLAY Used
          CFI CFA_SP SP+-2
          CFI CFA_PSP16 PSP16+0
          CFI CFA_XSP16 XSP16+0
          CFI `PSW.CY` SameValue
          CFI `B.BR0` SameValue
          CFI `B.BR1` SameValue
          CFI `B.BR2` SameValue
          CFI `B.BR3` SameValue
          CFI `B.BR4` SameValue
          CFI `B.BR5` SameValue
          CFI `B.BR6` SameValue
          CFI `B.BR7` SameValue
          CFI `VB.BR8` SameValue
          CFI `VB.BR9` SameValue
          CFI `VB.BR10` SameValue
          CFI `VB.BR11` SameValue
          CFI `VB.BR12` SameValue
          CFI `VB.BR13` SameValue
          CFI `VB.BR14` SameValue
          CFI `VB.BR15` SameValue
          CFI VB SameValue
          CFI B SameValue
          CFI A SameValue
          CFI PSW SameValue
          CFI DPL0 SameValue
          CFI DPH0 SameValue
          CFI R0 SameValue
          CFI R1 SameValue
          CFI R2 SameValue
          CFI R3 SameValue
          CFI R4 SameValue
          CFI R5 SameValue
          CFI R6 SameValue
          CFI R7 SameValue
          CFI V0 SameValue
          CFI V1 SameValue
          CFI V2 SameValue
          CFI V3 SameValue
          CFI V4 SameValue
          CFI V5 SameValue
          CFI V6 SameValue
          CFI V7 SameValue
          CFI PSPH Undefined
          CFI PSPL Undefined
          CFI XSPH Undefined
          CFI XSPL Undefined
          CFI ?RET Concat
          CFI ?RET_HIGH Frame(CFA_SP, 2)
          CFI ?RET_LOW Frame(CFA_SP, 1)
          CFI EndCommon cfiCommon1
        
`?<Name CLI2CReg 4>` SYMBOL "CLI2CReg"
??I2C_State         SYMBOL "I2C_State", `?<Name CLI2CReg 4>`

`??i2c_isr??INTVEC 67` SYMBOL "??INTVEC 67", ??i2c_isr
??i2c_timeout_flag  SYMBOL "i2c_timeout_flag", `?<Name CLI2CReg 4>`
??i2cwait           SYMBOL "i2cwait", `?<Name CLI2CReg 4>`
??slave_nack_flag   SYMBOL "slave_nack_flag", `?<Name CLI2CReg 4>`
??ucI2C_MX          SYMBOL "ucI2C_MX", `?<Name CLI2CReg 4>`

        EXTERN `??operator delete`
        FUNCTION `??operator delete`,010202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 8, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN `??operator new`
        FUNCTION `??operator new`,010202H
        ARGFRAME ISTACK, 2, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 0, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC

// J:\Projet_Session5_LNAH\S2_18Nov2014\Programme Station 2\FESTO\Libraire\CLI2CReg.cpp
//    1 // ***************** FICHIER:CLI2CREG.cpp
//    2 //
//    3 //  Description: Contient les déclaration pour le i2c matériel
//    4 //               
//    5 //
//    6 //  Application realisee avec IAR
//    7 //
//    8 //  AUTEUR : Gabriel Fortin-Belanger
//    9 //  DATE CREATION :    2014-02-07		 VERSION: 1.0
//   10 //  DATE MODIFICATION: ****-**-**
//   11 //
//   12 //******************************************************************************
//   13 #include "CLI2CReg.h"

        ASEGN SFR_AN:DATA:NOROOT,0a7H
// union <unnamed> volatile __sfr _A_IEA
_A_IEA:
        DATA8
        DS 1

        ASEGN SFR_AN:DATA:NOROOT,0a8H
// union <unnamed> volatile __sfr _A_IE
_A_IE:
        DATA8
        DS 1

        ASEGN SFR_AN:DATA:NOROOT,0b7H
// union <unnamed> volatile __sfr _A_IPA
_A_IPA:
        DATA8
        DS 1

        ASEGN SFR_AN:DATA:NOROOT,0ddH
// union <unnamed> volatile __sfr _A_S2STA
_A_S2STA:
        DATA8
        DS 1

        ASEGN SFR_AN:DATA:NOROOT,0dcH
// union <unnamed> volatile __sfr _A_S2CON
_A_S2CON:
        DATA8
        DS 1

        ASEGN SFR_AN:DATA:NOROOT,090H
// union <unnamed> volatile __sfr _A_P1
_A_P1:
        DATA8
        DS 1

        ASEGN SFR_AN:DATA:NOROOT,093H
// union <unnamed> volatile __sfr _A_P3SFS
_A_P3SFS:
        DATA8
        DS 1

        ASEGN SFR_AN:DATA:NOROOT,0deH
// unsigned char volatile __sfr S2DAT
S2DAT:
        DATA8
        DS 1
//   14 #include "_DeclarationGenerale.h"
//   15 #include "CLI2CPort.h"
//   16 
//   17 
//   18 

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//   19         UC CLI2CReg :: I2C_State;
??I2C_State:
        DS 1
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//   20         UC CLI2CReg :: ucI2C_MX;
??ucI2C_MX:
        DS 1
        REQUIRE __INIT_XDATA_Z
//   21   
//   22 
//   23 
//   24 // S2STA 
//   25     

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//   26 xdata unsigned char i2c_xmit_buf[256]; // message xmit buffer
i2c_xmit_buf:
        DS 256
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//   27 xdata unsigned char i2c_rcv_buf[256]; // message rcv buffer
i2c_rcv_buf:
        DS 256
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA16
//   28 unsigned int i;                       // array pointer
i:
        DS 2
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//   29 unsigned char  dummybyte;
dummybyte:
        DS 1
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//   30 UC  i2c_timeout; // dummy byte to rcv, timeout cntr
i2c_timeout:
        DS 1
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//   31 UC  i2c_init_flag; 
i2c_init_flag:
        DS 1
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//   32 UC CLI2CReg :: i2cwait; 
??i2cwait:
        DS 1
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//   33 UC  i2c_master; 
i2c_master:
        DS 1
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//   34 UC  i2c_xmitr; // callable status flag bits
i2c_xmitr:
        DS 1
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//   35 UC  bus_lost_flag; 
bus_lost_flag:
        DS 1
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//   36 UC CLI2CReg :: slave_nack_flag; 
??slave_nack_flag:
        DS 1
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//   37 UC CLI2CReg :: i2c_timeout_flag;// error flag bits    
??i2c_timeout_flag:
        DS 1
        REQUIRE __INIT_XDATA_Z

        RSEG NEAR_CODE:CODE:NOROOT(0)
// __near_func __xdata_reentrant CLI2CReg &CLI2CReg::new CLI2CReg()
`??new CLI2CReg`:
          CFI Block cfiBlock0 Using cfiCommon0
          CFI Function `??new CLI2CReg`
        CODE
        FUNCALL `??new CLI2CReg`, `??operator new`
        LOCFRAME ISTACK, 2, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 0, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 2, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 0, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL `??new CLI2CReg`, ??CLI2CReg
        LOCFRAME ISTACK, 2, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 0, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 2, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 0, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        PUSH    ?V0 + 0
          CFI V0 Frame(CFA_SP, 3)
          CFI CFA_SP SP+-3
        PUSH    ?V0 + 1
          CFI V1 Frame(CFA_SP, 4)
          CFI CFA_SP SP+-4
        ; Saved register size: 2
        ; Auto size: 0
        ; Setup parameters for call to function operator new(unsigned int)
        MOV     R2,#0x1
        MOV     R3,#0x0
        LCALL   `??operator new`
        MOV     ?V0 + 0,R2
        MOV     ?V0 + 1,R3
        MOV     R0,?V0 + 0
        MOV     R1,?V0 + 1
        MOV     A,R0
        MOV     R2,A
        MOV     A,R1
        MOV     R3,A
        MOV     A,R0
        ORL     A,R1
        JZ      `??new CLI2CReg_1`
        ; Setup parameters for call to function CLI2CReg::CLI2CReg()
        LCALL   ??CLI2CReg
        MOV     ?V0 + 0,R2
        MOV     ?V0 + 1,R3
        MOV     R2,?V0 + 0
        MOV     R3,?V0 + 1
        SJMP    `??new CLI2CReg_2`
`??new CLI2CReg_1`:
        MOV     R2,#0x0
        MOV     R3,#0x0
`??new CLI2CReg_2`:
        POP     ?V0 + 1
          CFI V1 SameValue
          CFI CFA_SP SP+-3
        POP     ?V0 + 0
          CFI V0 SameValue
          CFI CFA_SP SP+-2
        RET
          CFI EndBlock cfiBlock0

        RSEG NEAR_CODE:CODE:NOROOT(0)
// __near_func __xdata_reentrant void CLI2CReg::delete ~CLI2CReg(CLI2CReg *)
`??delete ~CLI2CReg`:
          CFI Block cfiBlock1 Using cfiCommon0
          CFI Function `??delete ~CLI2CReg`
        CODE
        FUNCALL `??delete ~CLI2CReg`, `?~CLI2CReg`
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 8, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 8, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL `??delete ~CLI2CReg`, `??operator delete`
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 8, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 8, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x8
        LCALL   ?FUNC_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 8)
        ; Saved register size: 8
        ; Auto size: 0
        MOV     A,R2
        MOV     R6,A
        MOV     A,R3
        MOV     R7,A
        MOV     A,R6
        ORL     A,R7
        JZ      `??delete ~CLI2CReg_1`
        ; Setup parameters for call to function CLI2CReg::~CLI2CReg()
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        LCALL   `?~CLI2CReg`
        ; Setup parameters for call to function operator delete(void *)
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        LCALL   `??operator delete`
`??delete ~CLI2CReg_1`:
        MOV     R7,#0x1
        LJMP    ?FUNC_LEAVE_XDATA
          CFI EndBlock cfiBlock1
//   38         
//   39         

        RSEG NEAR_CODE:CODE:NOROOT(0)
//   40 CLI2CReg :: CLI2CReg(void)
??CLI2CReg:
          CFI Block cfiBlock2 Using cfiCommon0
          CFI Function ??CLI2CReg
        CODE
//   41 {
        ; Saved register size: 0
        ; Auto size: 0
//   42 
//   43 
//   44 
//   45 }
        RET
          CFI EndBlock cfiBlock2
//   46 
//   47 

        RSEG NEAR_CODE:CODE:NOROOT(0)
//   48 CLI2CReg :: ~CLI2CReg(void)
`?~CLI2CReg`:
          CFI Block cfiBlock3 Using cfiCommon0
          CFI Function `?~CLI2CReg`
        CODE
//   49 {
        ; Saved register size: 0
        ; Auto size: 0
//   50 
//   51 	
//   52 
//   53 }
        RET
          CFI EndBlock cfiBlock3
//   54 

        RSEG NEAR_CODE:CODE:NOROOT(0)
//   55 void CLI2CReg :: vI2CRegInit(void)
??vI2CRegInit:
          CFI Block cfiBlock4 Using cfiCommon0
          CFI Function ??vI2CRegInit
        CODE
//   56 {
        PUSH    DPL
          CFI DPL0 Frame(CFA_SP, 3)
          CFI CFA_SP SP+-3
        PUSH    DPH
          CFI DPH0 Frame(CFA_SP, 4)
          CFI CFA_SP SP+-4
        ; Saved register size: 2
        ; Auto size: 0
//   57   
//   58   
//   59      P3SFS |= 0xC0; //
        ORL     0x93,#0xc0
//   60      S2CON |= 0x80; // Frequence deu crystal a 100khz;
        ORL     0xdc,#0x80
//   61      i2c_init_flag = 1; // set init done flag
        MOV     DPTR,#i2c_init_flag
        MOV     A,#0x1
        MOVX    @DPTR,A
//   62      i2c_timeout_flag = 0; // clear timeout error flag
        MOV     DPTR,#??i2c_timeout_flag
        MOV     A,#0x0
        MOVX    @DPTR,A
//   63      //PX1 =0;
//   64      IPA |= 0x02; // set high priority for EI2C
        ORL     0xb7,#0x2
//   65      IEA |= 0x02; // set EI2C I2C Int. Enable bit
        ORL     0xa7,#0x2
//   66      //EX1 = 1;
//   67       EA =1;
        SETB    0xa8.7
//   68      
//   69     
//   70 
//   71 }
        POP     DPH
          CFI DPH0 SameValue
          CFI CFA_SP SP+-3
        POP     DPL
          CFI DPL0 SameValue
          CFI CFA_SP SP+-2
        RET
          CFI EndBlock cfiBlock4
        REQUIRE _A_P3SFS
        REQUIRE _A_S2CON
        REQUIRE _A_IPA
        REQUIRE _A_IEA
        REQUIRE _A_IE
//   72 

        RSEG NEAR_CODE:CODE:NOROOT(0)
//   73 UC CLI2CReg :: ucI2CMaster_Transmit(UC ucSlaveAdr,UC ucData)
??ucI2CMaster_Transmit:
          CFI Block cfiBlock5 Using cfiCommon0
          CFI Function ??ucI2CMaster_Transmit
        CODE
//   74 {
        FUNCALL ??ucI2CMaster_Transmit, ??vWaitForInt
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 9, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 9, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL ??ucI2CMaster_Transmit, ??vWaitForInt
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 9, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 9, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x9
        LCALL   ?FUNC_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 9)
        ; Saved register size: 9
        ; Auto size: 0
        MOV     A,R2
        MOV     R6,A
        MOV     A,R3
        MOV     R7,A
        MOV     ?V0 + 0,R1
        MOV     ?V0 + 1,R4
//   75 
//   76   
//   77   P1_1 = 0;
        CLR     0x90.1
//   78   while(S2STA_bit.Bbusy != 0);
??ucI2CMaster_Transmit_1:
        MOV     A,0xdd
        MOV     C,0xE0 /* A   */.3
        JC      ??ucI2CMaster_Transmit_1
//   79   i2c_master = 1;
        MOV     DPTR,#i2c_master
        MOV     A,#0x1
        MOVX    @DPTR,A
//   80   i2c_xmitr = 1; // set up for master transmitter
        MOV     DPTR,#i2c_xmitr
        MOV     A,#0x1
        MOVX    @DPTR,A
//   81   I2C_State = ucI2C_MX;
        MOV     DPTR,#??ucI2C_MX
        MOVX    A,@DPTR
        MOV     DPTR,#??I2C_State
        MOVX    @DPTR,A
//   82   S2DAT = ucSlaveAdr;
        MOV     0xde,?V0 + 0
//   83   S2CON_bit.EN1 = 1;
        ORL     0xdc,#0x40
//   84   S2CON_bit.STO = 0;
        ANL     0xdc,#0xef
//   85   S2CON_bit.STA = 1;
        ORL     0xdc,#0x20
//   86   S2CON_bit.AA = 0;
        ANL     0xdc,#0xfb
//   87   vWaitForInt();
        ; Setup parameters for call to function CLI2CReg::vWaitForInt()
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        LCALL   ??vWaitForInt
//   88    S2CON_bit.STA = 0;
        ANL     0xdc,#0xdf
//   89    S2CON_bit.STO = 1; // set STO (stop bit)
        ORL     0xdc,#0x10
//   90    S2DAT = ucData; // send last data byte 
        MOV     0xde,?V0 + 1
//   91    vWaitForInt(); // Wait for interrupt
        ; Setup parameters for call to function CLI2CReg::vWaitForInt()
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        LCALL   ??vWaitForInt
//   92    S2DAT = 0xFF;
        MOV     0xde,#-0x1
//   93    S2CON_bit.STO = 0;
        ANL     0xdc,#0xef
//   94    S2CON_bit.EN1 = 0;
        ANL     0xdc,#0xbf
//   95 
//   96   
//   97 
//   98 
//   99 
//  100 }
        MOV     R7,#0x2
        LJMP    ?FUNC_LEAVE_XDATA
          CFI EndBlock cfiBlock5
        REQUIRE _A_P1
        REQUIRE _A_S2STA
        REQUIRE S2DAT
        REQUIRE _A_S2CON
//  101 

        RSEG NEAR_CODE:CODE:NOROOT(0)
//  102 UC CLI2CReg :: upsd_i2c_rcv (unsigned char i2c_address)
??upsd_i2c_rcv:
          CFI Block cfiBlock6 Using cfiCommon0
          CFI Function ??upsd_i2c_rcv
        CODE
//  103 {
        FUNCALL ??upsd_i2c_rcv, ??vWaitForInt
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 8, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 8, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL ??upsd_i2c_rcv, ??vWaitForInt
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 8, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 8, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL ??upsd_i2c_rcv, ??vWaitForInt
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 8, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 8, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x8
        LCALL   ?FUNC_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 8)
        ; Saved register size: 8
        ; Auto size: 0
        MOV     A,R2
        MOV     R6,A
        MOV     A,R3
        MOV     R7,A
        MOV     ?V0 + 0,R1
//  104   while(S2STA_bit.Bbusy != 0);
??upsd_i2c_rcv_1:
        MOV     A,0xdd
        MOV     C,0xE0 /* A   */.3
        JC      ??upsd_i2c_rcv_1
//  105   i2c_master = 1;
        MOV     DPTR,#i2c_master
        MOV     A,#0x1
        MOVX    @DPTR,A
//  106   i2c_xmitr = 0; // set flags for master receiver
        MOV     DPTR,#i2c_xmitr
        MOV     A,#0x0
        MOVX    @DPTR,A
//  107 
//  108 
//  109   
//  110   S2DAT = (i2c_address | 0x01); // set up i2c address (set R/W bit)
        MOV     A,#0x1
        ORL     A,?V0 + 0
        MOV     0xde,A
//  111   S2CON_bit.EN1 = 1;
        ORL     0xdc,#0x40
//  112   S2CON_bit.STO =  0;
        ANL     0xdc,#0xef
//  113   S2CON_bit.STA = 1;
        ORL     0xdc,#0x20
//  114   S2CON_bit.AA = 0;
        ANL     0xdc,#0xfb
//  115   vWaitForInt();
        ; Setup parameters for call to function CLI2CReg::vWaitForInt()
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        LCALL   ??vWaitForInt
//  116   S2CON_bit.STA = 0;
        ANL     0xdc,#0xdf
//  117   S2DAT = 0xFF; // send byte for rcv mode
        MOV     0xde,#-0x1
//  118    S2CON_bit.AA = 1;
        ORL     0xdc,#0x4
//  119  vWaitForInt();
        ; Setup parameters for call to function CLI2CReg::vWaitForInt()
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        LCALL   ??vWaitForInt
//  120  // for (i=0; i < (data_len-1); i++)
//  121  // {
//  122  //  dummybyte = S2STA; // Dummy Read S2STA
//  123  //  i2c_rcv_buf[i] = S2DAT; // Get data byte from Slave
//  124  //  vWaitForInt(); // Wait for interrupt
//  125  // }
//  126   S2CON_bit.AA = 0;
        ANL     0xdc,#0xfb
//  127    i2c_rcv_buf[i] = S2DAT; // Get last data byte
        MOV     A,0xde
        PUSH    A
          CFI CFA_SP SP+-1
        MOV     DPTR,#i
        MOVX    A,@DPTR
        ADD     A,#i2c_rcv_buf & 0xff
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        ADDC    A,#(i2c_rcv_buf >> 8) & 0xff
        MOV     R1,A
        MOV     DPL,R0
        MOV     DPH,R1
        POP     A
          CFI CFA_SP SP+0
        MOVX    @DPTR,A
//  128     vWaitForInt(); // Wait for interrupt
        ; Setup parameters for call to function CLI2CReg::vWaitForInt()
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        LCALL   ??vWaitForInt
//  129    dummybyte = S2STA; // Dummy Read S2STA
        MOV     A,0xdd
        MOV     DPTR,#dummybyte
        MOVX    @DPTR,A
//  130    //i++;
//  131    i2c_rcv_buf[i] = S2DAT; // Get dummy data byte
        MOV     A,0xde
        PUSH    A
          CFI CFA_SP SP+-1
        MOV     DPTR,#i
        MOVX    A,@DPTR
        ADD     A,#i2c_rcv_buf & 0xff
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        ADDC    A,#(i2c_rcv_buf >> 8) & 0xff
        MOV     R1,A
        MOV     DPL,R0
        MOV     DPH,R1
        POP     A
          CFI CFA_SP SP+0
        MOVX    @DPTR,A
//  132    return(i2c_rcv_buf[i]);
        MOV     DPTR,#i
        MOVX    A,@DPTR
        ADD     A,#i2c_rcv_buf & 0xff
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        ADDC    A,#(i2c_rcv_buf >> 8) & 0xff
        MOV     R1,A
        MOV     DPL,R0
        MOV     DPH,R1
        MOVX    A,@DPTR
        MOV     R1,A
        MOV     R7,#0x1
        LJMP    ?FUNC_LEAVE_XDATA
          CFI EndBlock cfiBlock6
        REQUIRE _A_S2STA
        REQUIRE S2DAT
        REQUIRE _A_S2CON
//  133 }
//  134 

        RSEG NEAR_CODE:CODE:NOROOT(0)
//  135 void CLI2CReg :: vWaitForInt(void)
??vWaitForInt:
          CFI Block cfiBlock7 Using cfiCommon0
          CFI Function ??vWaitForInt
        CODE
//  136 {
        PUSH    DPL
          CFI DPL0 Frame(CFA_SP, 3)
          CFI CFA_SP SP+-3
        PUSH    DPH
          CFI DPH0 Frame(CFA_SP, 4)
          CFI CFA_SP SP+-4
        ; Saved register size: 2
        ; Auto size: 0
//  137   int i;
//  138   i2cwait = 1; //
        MOV     DPTR,#??i2cwait
        MOV     A,#0x1
        MOVX    @DPTR,A
//  139   i2c_timeout = 0;
        MOV     DPTR,#i2c_timeout
        MOV     A,#0x0
        MOVX    @DPTR,A
        SJMP    ??vWaitForInt_1
//  140   while (i2cwait == 1)
//  141    { // .. wait for int to clear flag
//  142      if(i2c_timeout >= 10)
//  143        { // 10mS timeout loop
//  144          i2c_timeout_flag = 1;// set error flag
//  145          i2cwait = 0; //
//  146        }
//  147 
//  148      for(i=0;i<200;i++);
??vWaitForInt_2:
        MOV     A,R0
        ADD     A,#0x1
        MOV     R0,A
        MOV     A,R1
        ADDC    A,#0x0
        MOV     R1,A
??vWaitForInt_3:
        CLR     C
        MOV     A,R0
        SUBB    A,#-0x38
        MOV     A,R1
        SUBB    A,#0x0
        MOV     C,0xD0 /* PSW */.2
        XRL     A,PSW
        RLC     A
        JC      ??vWaitForInt_2
//  149      i2c_timeout++;
        MOV     DPTR,#i2c_timeout
        MOVX    A,@DPTR
        ADD     A,#0x1
        MOVX    @DPTR,A
??vWaitForInt_1:
        MOV     DPTR,#??i2cwait
        MOVX    A,@DPTR
        XRL     A,#0x1
        JNZ     ??vWaitForInt_4
        MOV     DPTR,#i2c_timeout
        MOVX    A,@DPTR
        CLR     C
        SUBB    A,#0xa
        JC      ??vWaitForInt_5
        MOV     DPTR,#??i2c_timeout_flag
        MOV     A,#0x1
        MOVX    @DPTR,A
        MOV     DPTR,#??i2cwait
        MOV     A,#0x0
        MOVX    @DPTR,A
??vWaitForInt_5:
        MOV     R0,#0x0
        MOV     R1,#0x0
        SJMP    ??vWaitForInt_3
//  150 
//  151   }
//  152 }
??vWaitForInt_4:
        POP     DPH
          CFI DPH0 SameValue
          CFI CFA_SP SP+-3
        POP     DPL
          CFI DPL0 SameValue
          CFI CFA_SP SP+-2
        RET
          CFI EndBlock cfiBlock7
//  153 
//  154 
//  155 #pragma vector = 0x43

        RSEG NEAR_CODE:CODE:NOROOT(0)
//  156  __interrupt void CLI2CReg :: i2c_isr(void)
??i2c_isr:
          CFI Block cfiBlock8 Using cfiCommon1
          CFI Function ??i2c_isr
        CODE
//  157 {
        PUSH    A
          CFI A Frame(CFA_SP, 3)
          CFI CFA_SP SP+-3
        PUSH    PSW
          CFI PSW Frame(CFA_SP, 4)
          CFI CFA_SP SP+-4
        MOV     A,R0
          CFI R0 A
        PUSH    A
          CFI R0 Frame(CFA_SP, 5)
          CFI CFA_SP SP+-5
        PUSH    DPL
          CFI DPL0 Frame(CFA_SP, 6)
          CFI CFA_SP SP+-6
        PUSH    DPH
          CFI DPH0 Frame(CFA_SP, 7)
          CFI CFA_SP SP+-7
        ; Saved register size: 5
        ; Auto size: 0
//  158   P1_1 = 1;
        SETB    0x90.1
//  159 if (S2STA_bit.Blost == 1)
        MOV     A,0xdd
        MOV     C,0xE0 /* A   */.2
        JNC     ??i2c_isr_1
//  160 {
//  161 S2DAT = 0xFF; // send dummy byte
        MOV     0xde,#-0x1
//  162 bus_lost_flag = 1;
        MOV     DPTR,#bus_lost_flag
        MOV     A,#0x1
        MOVX    @DPTR,A
//  163 }
//  164 if (S2STA_bit.ACK_R == 1)
??i2c_isr_1:
        MOV     A,0xdd
        MOV     C,0xE0 /* A   */.1
        JNC     ??i2c_isr_2
//  165 {
//  166 
//  167 S2DAT = 0xFF; // send dummy byte
        MOV     0xde,#-0x1
//  168 slave_nack_flag = 1;
        MOV     DPTR,#??slave_nack_flag
        MOV     A,#0x1
        MOVX    @DPTR,A
//  169 }
//  170 if (i2c_master & i2c_xmitr)
??i2c_isr_2:
        MOV     DPTR,#i2c_xmitr
        MOVX    A,@DPTR
        MOV     R0,A
        MOV     DPTR,#i2c_master
        MOVX    A,@DPTR
        ANL     A,R0
        JZ      ??i2c_isr_3
//  171 { 
//  172 i2cwait = 0; // reset wait flag
        MOV     DPTR,#??i2cwait
        MOV     A,#0x0
        MOVX    @DPTR,A
//  173 }
//  174 if (i2c_master & ~i2c_xmitr)
??i2c_isr_3:
        MOV     DPTR,#i2c_xmitr
        MOVX    A,@DPTR
        CPL     A
        MOV     R0,A
        MOV     DPTR,#i2c_master
        MOVX    A,@DPTR
        ANL     A,R0
        JZ      ??i2c_isr_4
//  175 { // mstr receiver mode
//  176 i2cwait = 0; // reset wait flag
        MOV     DPTR,#??i2cwait
        MOV     A,#0x0
        MOVX    @DPTR,A
//  177 }
//  178 }
??i2c_isr_4:
        POP     DPH
          CFI DPH0 SameValue
          CFI CFA_SP SP+-6
        POP     DPL
          CFI DPL0 SameValue
          CFI CFA_SP SP+-5
        POP     A
          CFI R0 A
          CFI CFA_SP SP+-4
        MOV     R0,A
          CFI R0 SameValue
        POP     PSW
          CFI PSW SameValue
          CFI CFA_SP SP+-3
        POP     A
          CFI A SameValue
          CFI CFA_SP SP+-2
        RETI
          CFI EndBlock cfiBlock8
        REQUIRE _A_P1
        REQUIRE _A_S2STA
        REQUIRE S2DAT

        COMMON INTVEC:CODE:ROOT(0)
        ORG 67
`??i2c_isr??INTVEC 67`:
        LJMP       (??i2c_isr)

        END
// 
//   3 bytes in segment INTVEC
// 545 bytes in segment NEAR_CODE
//   8 bytes in segment SFR_AN
// 525 bytes in segment XDATA_Z
// 
// 545 bytes of CODE  memory (+ 3 bytes shared)
//   0 bytes of DATA  memory (+ 8 bytes shared)
// 525 bytes of XDATA memory
//
//Errors: none
//Warnings: 1
